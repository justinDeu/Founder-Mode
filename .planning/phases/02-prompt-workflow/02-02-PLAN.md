---
phase: 02-prompt-workflow
plan: 02
type: execute
---

<objective>
Refine the run-prompt command for frictionless default execution and reliable background monitoring.

Purpose: Make the simple case truly simple (run Claude inline, no menus) while enabling background execution with clear status tracking.
Output: Enhanced run-prompt with zero-friction default path and background COMPLETION.md monitoring.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/1-RESEARCH.md
@.planning/phases/02-prompt-workflow/2-CONTEXT.md

**Existing code to modify:**
@commands/run-prompt.md
@scripts/executor.py

**Key requirements from 2-CONTEXT.md:**
- Simple case is simple: `/run-prompt prompts/fix-bug.md` runs immediately in Claude. No model menus. No worktree questions. No decision fatigue.
- Background monitors work reliably: Spawn, watch, notify on completion or failure
- Default model is Claude, runs inline, zero questions asked
- Options like --worktree, --model, --loop only matter when explicitly requested
</context>

<tasks>

<task type="auto">
  <name>Task 1: Simplify default execution path</name>
  <files>commands/run-prompt.md</files>
  <action>
Modify run-prompt.md to ensure the default case is frictionless:

1. **Default Behavior (no flags):**
   - Read prompt file content
   - Spawn Task subagent with prompt content
   - Wait for completion
   - Report summary
   - No model selection prompts
   - No confirmation dialogs
   - No intermediate questions

2. **Simplify Claude Foreground Section:**
   Replace current `<claude_foreground>` with cleaner, more direct execution:
   ```
   Task(
     prompt: """
     <task>
     {prompt_content}
     </task>

     Execute completely. Summarize what was accomplished.
     """,
     subagent_type: "general-purpose"
   )
   ```

3. **Move Complexity to Flags:**
   - --model: Only show model options when explicitly requested
   - --worktree: Only create worktree when explicitly requested
   - --background: Only run in background when explicitly requested
   - Default is foreground Claude execution with immediate output

4. **Streamline Output:**
   For default execution, just show:
   ```
   Running: {prompt_file}

   {Task result/summary}
   ```

   No "Execution Complete" headers, no redundant metadata unless --verbose.

5. **Error Handling:**
   - Prompt file not found: Suggest `ls ./prompts/`
   - Task fails: Show error, suggest checking prompt content
  </action>
  <verify>
Read commands/run-prompt.md and confirm:
- Default execution (no flags) spawns Task directly without menus
- Output is clean and minimal for default case
- Complex options only trigger when flags are provided
  </verify>
  <done>
run-prompt default path runs prompt in Claude immediately with minimal output. No menus, no confirmations, no decision fatigue.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance background execution monitoring</name>
  <files>commands/run-prompt.md</files>
  <action>
Improve the --background execution path with reliable completion tracking:

1. **Background Task with COMPLETION.md:**
   Update `<claude_background>` section to be more explicit about completion file:
   ```
   Task(
     prompt: """
     <task>
     {prompt_content}
     </task>

     <working_directory>{cwd}</working_directory>

     <completion_protocol>
     When finished, write {cwd}/COMPLETION.md with:

     # Completion Status

     **Status:** SUCCESS | FAILED | PARTIAL
     **Finished:** {timestamp}

     ## Summary
     [What was accomplished]

     ## Files Changed
     - path/to/file - description

     ## Verification
     - [x] or [ ] Build passed
     - [x] or [ ] Tests passed

     ## Issues (if any)
     [Problems encountered]
     </completion_protocol>

     Execute the task completely, then write COMPLETION.md.
     """,
     subagent_type: "general-purpose",
     run_in_background: true
   )
   ```

2. **User Feedback After Spawning:**
   Show clear instructions:
   ```
   Background task started.

   Working directory: {cwd}

   Check status:
     cat {cwd}/COMPLETION.md

   Watch progress:
     watch -n 5 'test -f {cwd}/COMPLETION.md && cat {cwd}/COMPLETION.md || echo "Still running..."'
   ```

3. **Worktree + Background Combination:**
   When both --worktree and --background are used:
   - Create worktree first (sync operation)
   - Then spawn background task in worktree
   - COMPLETION.md goes in worktree directory
   - After completion, changes are in isolated branch

4. **Non-Claude Background (executor.py):**
   For non-Claude models with --background:
   - executor.py already handles log files
   - Add suggestion to check log file path
   - Mention `tail -f {log_path}` for watching
  </action>
  <verify>
Read commands/run-prompt.md and confirm:
- Background task includes explicit COMPLETION.md protocol
- User gets clear instructions for checking status
- Worktree + background combination works correctly
  </verify>
  <done>
Background execution creates predictable COMPLETION.md with status, summary, and verification results. User knows exactly how to check completion status.
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Default `/founder-mode:run-prompt prompt.md` runs immediately without menus
- [ ] Background execution creates COMPLETION.md with structured status
- [ ] User gets clear instructions for monitoring background tasks
- [ ] Worktree + background combination documented and working
</verification>

<success_criteria>

- Default execution is frictionless (no menus, no confirmations)
- Background tasks produce structured COMPLETION.md
- Users know how to check background task status
- Plan 02-02 complete, ready for Phase 2 summary
</success_criteria>

<output>
After completion, create `.planning/phases/02-prompt-workflow/02-02-SUMMARY.md`

Since this is the final plan in Phase 2, also ensure Phase 2 is ready for completion.
</output>
